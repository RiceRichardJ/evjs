<!DOCTYPE html>
<!-- saved from url=(0034)http://ricerichardj.com/sound.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf‐8">
<title> Hello web audio </title> </head>
<body>

<script>
/**
 * https://www.html5rocks.com/en/tutorials/webaudio/intro/
 */
class BufferLoader {
	constructor(context, urlList, callback) {
		console.log("BufferLoader constructor");
		this.context    = context;
		this.urlList    = urlList;
		this.callback   = callback;
		this.bufferList = [];
		this.loadCount  = 0;
		this.that = this;
	}
	
	/**
	 * Download all sound files, decode them, save into buffer list.
	 */
	load() {
		console.log("BufferLoader.load()");
		for (var i = 0; i < this.urlList.length; ++i) {
			this.loadBuffer(this.urlList[i], i);
		}
	}

	/**
	 * Load buffer asynchronously.
	 */
	loadBuffer(url, index) {
		console.log("BufferLoader.loadBuffer()");
		var ajax = new XMLHttpRequest();
		ajax.open("GET", url, true);
		ajax.responseType = "arraybuffer";
		ajax.onload       = () => decode(this, ajax.response, index);
		ajax.onerror      = () => console.log('BufferLoader: XHR error');
		ajax.send();
	}
}

/**
 * Asynchronously decode the audio file data in request.response
 */
function decode(loader, file, index) {
	console.log("BufferLoader.requestOnLoad()" + loader);
	loader.context.decodeAudioData(
		file,
		buffer => {
			if (!buffer) { console.log('error decoding file data: ' + url); return; }
			loader.bufferList[index] = buffer;
			if (++loader.loadCount == loader.urlList.length) {
				loader.callback(loader.bufferList);
			}
		},
		error => { console.error('decodeAudioData error', error); }
	);
}



window.onload = function() {
	var sound = new Sound([
		'Rocket.mp3',
		'Proton.mp3',
	]);
}

class Sound {
	constructor(fileList) {
		console.log("Construct Sound");
		this.audioCtx     = new (window.AudioContext || window.webkitAudioContext);
		this.bufferLoader = new BufferLoader(
			this.audioCtx,
			fileList,
			bufferList => this.help(this.audioCtx, bufferList)
		);
		this.bufferLoader.load();
	}

	help(audioCtx, bufferList) {
		console.log("finishedLoading(" + bufferList + ")");
		// Create two sources and play them both together.
		var source1 = audioCtx.createBufferSource();
		var source2 = audioCtx.createBufferSource();
		source1.buffer = bufferList[0];
		source2.buffer = bufferList[1];

		source1.connect(audioCtx.destination);
		source2.connect(audioCtx.destination);
		source1.start(0);
		source2.start(0);
	}
}

</script>
</body></html>